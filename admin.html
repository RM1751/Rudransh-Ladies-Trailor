<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Rudrans Ladies Tailoring</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f5f5;
        }
        .admin-login {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #8B0000 0%, #5C0000 100%);
            padding: 20px;
        }
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            animation: slideUp 0.5s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .login-box h2 {
            color: #8B0000;
            text-align: center;
            margin-bottom: 30px;
        }
        .admin-panel {
            display: none;
            padding: 40px 0;
        }
        .admin-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .admin-section h3 {
            color: #8B0000;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #FFD700;
        }
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        .upload-area:hover, .upload-area.dragover {
            border-color: #8B0000;
            background: #fff8f0;
        }
        .upload-area input[type="file"] {
            display: none;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-card {
            background: #f5f5f5;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        .image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .image-card .placeholder-img {
            width: 100%;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e0e0e0 0%, #d0d0d0 100%);
            font-size: 3rem;
        }
        .image-card .info {
            padding: 10px;
        }
        .image-card .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logout-btn {
            background: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            float: right;
            font-size: 1rem;
        }
        .logout-btn:hover {
            background: #c82333;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .login-box {
                padding: 25px;
                margin: 10px;
            }
            .login-box h2 {
                font-size: 1.5rem;
            }
            .admin-section {
                padding: 20px;
                margin-bottom: 20px;
            }
            .upload-area {
                padding: 25px;
            }
            .upload-area span {
                font-size: 2rem !important;
            }
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 10px;
            }
            .navbar .container {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            .logout-btn {
                float: none;
                width: 100%;
            }
            .admin-panel .container {
                padding: 0 15px;
            }
            input, select, textarea {
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
        }
        
        @media (max-width: 480px) {
            .login-box {
                padding: 20px;
            }
            .image-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .admin-section h3 {
                font-size: 1.1rem;
            }
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error message */
        .error-msg {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
            border: 1px solid #f5c6cb;
        }
        
        /* Password reset styles */
        .password-reset-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
        }
        
        .form-toggle {
            text-align: center;
            margin-top: 15px;
        }
        
        .form-toggle a {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .form-toggle a:hover {
            text-decoration: underline;
        }
        
        .hidden {
            display: none !important;
        }
        
        .password-requirements {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
        
        .category-select {
            margin-top: 20px;
        }
        .preview-area {
            margin-top: 20px;
            display: none;
        }
        .preview-area img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .success-msg {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="admin-login">
        <div class="login-box">
            <h2>üßµ Admin Login</h2>
            <!-- Login Form -->
            <form id="loginForm">
                <div id="errorMessage" class="error-msg"></div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required placeholder="Enter admin password" autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary" id="loginBtn" style="width: 100%;">
                    <span id="btnText">Login</span>
                </button>
                <div class="form-toggle">
                    <a href="#" onclick="showResetForm(); return false;">Forgot Password?</a>
                </div>
            </form>

            <!-- Reset Password Form -->
            <form id="resetForm" class="hidden">
                <h3 style="text-align: center; margin-bottom: 20px; color: #8B0000;">Reset Password</h3>
                <div id="resetError" class="error-msg"></div>
                <div id="resetSuccess" class="success-msg" style="display: none; margin-bottom: 15px;"></div>
                
                <div class="form-group">
                    <label for="oldPassword">Current Password</label>
                    <input type="password" id="oldPassword" required placeholder="Enter current password">
                </div>
                
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" required placeholder="Enter new password" minlength="6">
                    <p class="password-requirements">Minimum 6 characters recommended</p>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input type="password" id="confirmPassword" required placeholder="Confirm new password">
                </div>
                
                <button type="submit" class="btn btn-primary" id="resetBtn" style="width: 100%;">
                    <span id="resetBtnText">Reset Password</span>
                </button>
                <div class="form-toggle">
                    <a href="#" onclick="showLoginForm(); return false;">‚Üê Back to Login</a>
                </div>
            </form>

            <p id="passwordHint" style="text-align: center; margin-top: 15px; color: #999; font-size: 0.85rem;">
                Default: <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 4px;">Ravi@12345</code>
            </p>
            <p style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9rem;">
                <a href="index.html" style="color: #8B0000;">‚Üê Back to Website</a>
            </p>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <h1>üßµ Rudrans</h1>
                    <span>Admin Panel</span>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </nav>

        <div class="container">
            <div id="successMessage" class="success-msg"></div>

            <!-- Upload Section -->
            <div class="admin-section">
                <h3>üì§ Upload New Image</h3>
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="imageInput" accept="image/*">
                    <span style="font-size: 3rem;">üì∑</span>
                    <p style="margin-top: 10px; font-size: 1.1rem;">Click or drag image here</p>
                    <p style="color: #666; font-size: 0.9rem;">Supports: JPG, PNG (Max 5MB)</p>
                </div>
                
                <div class="category-select">
                    <label for="imageCategory">Select Category:</label>
                    <select id="imageCategory">
                        <option value="blouse">Blouse</option>
                        <option value="kurti">Kurti</option>
                        <option value="salwar">Salwar Suit</option>
                        <option value="lehenga">Lehenga</option>
                        <option value="gown">Gown</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="preview-area" id="previewArea">
                    <p style="margin-bottom: 10px;">Preview:</p>
                    <img id="imagePreview" src="" alt="Preview">
                </div>

                <div style="margin-top: 20px;">
                    <label for="imageTitle">Image Title:</label>
                    <input type="text" id="imageTitle" placeholder="e.g., Princess Cut Blouse" style="margin-bottom: 15px;">
                    
                    <label for="imageDesc">Description:</label>
                    <input type="text" id="imageDesc" placeholder="Brief description of the garment">
                </div>

                <button class="btn btn-primary" id="uploadBtn" style="margin-top: 20px; width: 100%;" disabled>
                    Upload Image
                </button>
            </div>

            <!-- Manage Images Section -->
            <div class="admin-section">
                <h3>üñºÔ∏è Manage Gallery Images</h3>
                
                <div style="margin-bottom: 20px;">
                    <label>Filter by Category:</label>
                    <select id="filterCategory" onchange="filterImages()">
                        <option value="all">All</option>
                        <option value="blouse">Blouse</option>
                        <option value="kurti">Kurti</option>
                        <option value="salwar">Salwar Suit</option>
                        <option value="lehenga">Lehenga</option>
                        <option value="gown">Gown</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div id="imageGrid" class="image-grid">
                    <!-- Images will be loaded here -->
                    <p style="color: #666; text-align: center; grid-column: 1/-1;">
                        No images uploaded yet. Use the form above to add images.
                    </p>
                </div>
            </div>

            <!-- Change Password Section -->
            <div class="admin-section password-reset-section">
                <h3>üîê Change Password</h3>
                <p style="color: #666; margin-bottom: 15px;">Update your admin password for security.</p>
                
                <form id="changePasswordForm">
                    <div id="changeError" class="error-msg"></div>
                    <div id="changeSuccess" class="success-msg" style="display: none; margin-bottom: 15px;"></div>
                    
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" required placeholder="Enter current password">
                    </div>
                    
                    <div class="form-group">
                        <label for="newAdminPassword">New Password</label>
                        <input type="password" id="newAdminPassword" required placeholder="Enter new password" minlength="4">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmAdminPassword">Confirm New Password</label>
                        <input type="password" id="confirmAdminPassword" required placeholder="Confirm new password">
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Update Password
                    </button>
                </form>
            </div>

            <!-- Instructions -->
            <div class="admin-section" style="background: #fff8f0;">
                <h3>‚ÑπÔ∏è Instructions</h3>
                <ul style="line-height: 2; color: #333;">
                    <li>Upload images in JPG or PNG format only</li>
                    <li>Maximum file size: 5MB per image</li>
                    <li>Select appropriate category for better organization</li>
                    <li>Add descriptive titles to help customers understand</li>
                    <li>Images are stored locally in your browser</li>
                    <li>Deleted images cannot be recovered</li>
                    <li>Change your password regularly for security</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Admin Password - Stored in localStorage or default
        const DEFAULT_PASSWORD = 'Ravi@12345';
        
        // Get stored password or use default
        function getAdminPassword() {
            return localStorage.getItem('adminPassword') || DEFAULT_PASSWORD;
        }

        // Check if already logged in
        if (sessionStorage.getItem('adminLoggedIn') === 'true') {
            showAdminPanel();
        }

        // Form Toggle Functions
        function showResetForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('resetForm').classList.remove('hidden');
            document.getElementById('passwordHint').classList.add('hidden');
            document.getElementById('errorMessage').style.display = 'none';
        }
        
        function showLoginForm() {
            document.getElementById('resetForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('passwordHint').classList.remove('hidden');
            document.getElementById('resetError').style.display = 'none';
            document.getElementById('resetSuccess').style.display = 'none';
        }

        // Login Handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('errorMessage');
            const loginBtn = document.getElementById('loginBtn');
            const btnText = document.getElementById('btnText');
            
            // Show loading
            btnText.innerHTML = '<span class="spinner"></span> Logging in...';
            loginBtn.disabled = true;
            
            // Small delay for better UX
            setTimeout(() => {
                if (password === getAdminPassword()) {
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    errorDiv.style.display = 'none';
                    showAdminPanel();
                } else {
                    errorDiv.textContent = '‚ùå Incorrect password! Please try again.';
                    errorDiv.style.display = 'block';
                    document.getElementById('password').value = '';
                    document.getElementById('password').focus();
                    
                    // Reset button
                    btnText.textContent = 'Login';
                    loginBtn.disabled = false;
                }
            }, 500);
        });
        
        // Reset Password Handler (Login Screen)
        document.getElementById('resetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorDiv = document.getElementById('resetError');
            const successDiv = document.getElementById('resetSuccess');
            const resetBtn = document.getElementById('resetBtn');
            const resetBtnText = document.getElementById('resetBtnText');
            
            // Reset messages
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            // Show loading
            resetBtnText.innerHTML = '<span class="spinner"></span> Processing...';
            resetBtn.disabled = true;
            
            setTimeout(() => {
                // Validate old password
                if (oldPassword !== getAdminPassword()) {
                    errorDiv.textContent = '‚ùå Current password is incorrect!';
                    errorDiv.style.display = 'block';
                    resetBtnText.textContent = 'Reset Password';
                    resetBtn.disabled = false;
                    return;
                }
                
                // Validate new password match
                if (newPassword !== confirmPassword) {
                    errorDiv.textContent = '‚ùå New passwords do not match!';
                    errorDiv.style.display = 'block';
                    resetBtnText.textContent = 'Reset Password';
                    resetBtn.disabled = false;
                    return;
                }
                
                // Validate password length
                if (newPassword.length < 4) {
                    errorDiv.textContent = '‚ùå Password must be at least 4 characters!';
                    errorDiv.style.display = 'block';
                    resetBtnText.textContent = 'Reset Password';
                    resetBtn.disabled = false;
                    return;
                }
                
                // Save new password
                localStorage.setItem('adminPassword', newPassword);
                
                // Show success
                successDiv.textContent = '‚úÖ Password reset successful! Please login with your new password.';
                successDiv.style.display = 'block';
                
                // Clear form
                document.getElementById('oldPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
                resetBtnText.textContent = 'Reset Password';
                resetBtn.disabled = false;
                
                // Redirect to login after 2 seconds
                setTimeout(() => {
                    showLoginForm();
                }, 2000);
            }, 500);
        });
        
        // Change Password Handler (Admin Panel)
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value;
            const newAdminPassword = document.getElementById('newAdminPassword').value;
            const confirmAdminPassword = document.getElementById('confirmAdminPassword').value;
            const errorDiv = document.getElementById('changeError');
            const successDiv = document.getElementById('changeSuccess');
            
            // Reset messages
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            // Validate current password
            if (currentPassword !== getAdminPassword()) {
                errorDiv.textContent = '‚ùå Current password is incorrect!';
                errorDiv.style.display = 'block';
                return;
            }
            
            // Validate new password match
            if (newAdminPassword !== confirmAdminPassword) {
                errorDiv.textContent = '‚ùå New passwords do not match!';
                errorDiv.style.display = 'block';
                return;
            }
            
            // Validate password length
            if (newAdminPassword.length < 4) {
                errorDiv.textContent = '‚ùå Password must be at least 4 characters!';
                errorDiv.style.display = 'block';
                return;
            }
            
            // Save new password
            localStorage.setItem('adminPassword', newAdminPassword);
            
            // Show success
            successDiv.textContent = '‚úÖ Password changed successfully!';
            successDiv.style.display = 'block';
            
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newAdminPassword').value = '';
            document.getElementById('confirmAdminPassword').value = '';
            
            // Hide success after 3 seconds
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        });
        
        // Allow Enter key to submit
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('loginForm').dispatchEvent(new Event('submit'));
            }
        });

        function showAdminPanel() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            loadImages();
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            location.reload();
        }

        // File Upload Handling
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const previewArea = document.getElementById('previewArea');
        const imagePreview = document.getElementById('imagePreview');
        const uploadBtn = document.getElementById('uploadBtn');

        uploadArea.addEventListener('click', () => imageInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length) {
                imageInput.files = files;
                handleFileSelect(files[0]);
            }
        });

        imageInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            // Validate file
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                alert('File size should be less than 5MB');
                return;
            }

            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                previewArea.style.display = 'block';
                uploadBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        // Upload Button Handler
        uploadBtn.addEventListener('click', function() {
            const file = imageInput.files[0];
            const category = document.getElementById('imageCategory').value;
            const title = document.getElementById('imageTitle').value || 'Untitled';
            const desc = document.getElementById('imageDesc').value || '';

            if (!file) {
                alert('Please select an image first');
                return;
            }

            // Create image object
            const imageData = {
                id: Date.now(),
                title: title,
                description: desc,
                category: category,
                fileName: file.name,
                dataUrl: imagePreview.src,
                uploadedAt: new Date().toLocaleString()
            };

            // Save to localStorage (in production, this would be server-side)
            let images = JSON.parse(localStorage.getItem('galleryImages') || '[]');
            images.push(imageData);
            localStorage.setItem('galleryImages', JSON.stringify(images));

            // Show success message
            showSuccess('Image uploaded successfully!');

            // Reset form
            imageInput.value = '';
            previewArea.style.display = 'none';
            uploadBtn.disabled = true;
            document.getElementById('imageTitle').value = '';
            document.getElementById('imageDesc').value = '';

            // Refresh grid
            loadImages();
        });

        // Load Images
        function loadImages(filter = 'all') {
            const imageGrid = document.getElementById('imageGrid');
            const images = JSON.parse(localStorage.getItem('galleryImages') || '[]');
            
            if (images.length === 0) {
                imageGrid.innerHTML = '<p style="color: #666; text-align: center; grid-column: 1/-1;">No images uploaded yet.</p>';
                return;
            }

            const filteredImages = filter === 'all' 
                ? images 
                : images.filter(img => img.category === filter);

            if (filteredImages.length === 0) {
                imageGrid.innerHTML = '<p style="color: #666; text-align: center; grid-column: 1/-1;">No images in this category.</p>';
                return;
            }

            imageGrid.innerHTML = filteredImages.map(img => `
                <div class="image-card" data-id="${img.id}" data-category="${img.category}">
                    <button class="delete-btn" onclick="deleteImage(${img.id})" title="Delete">√ó</button>
                    ${img.dataUrl ? 
                        `<img src="${img.dataUrl}" alt="${escapeHtml(img.title)}" loading="lazy">` : 
                        `<div class="placeholder-img">${getCategoryIcon(img.category)}</div>`
                    }
                    <div class="info">
                        <strong>${escapeHtml(img.title)}</strong>
                        <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">${escapeHtml(img.description)}</p>
                        <p style="font-size: 0.75rem; color: #999; margin-top: 5px;">${img.uploadedAt}</p>
                    </div>
                </div>
            `).join('');
        }

        function filterImages() {
            const filter = document.getElementById('filterCategory').value;
            loadImages(filter);
        }

        function deleteImage(id) {
            if (!confirm('Are you sure you want to delete this image?')) {
                return;
            }

            let images = JSON.parse(localStorage.getItem('galleryImages') || '[]');
            images = images.filter(img => img.id !== id);
            localStorage.setItem('galleryImages', JSON.stringify(images));

            showSuccess('Image deleted successfully!');
            loadImages(document.getElementById('filterCategory').value);
        }

        function getCategoryIcon(category) {
            const icons = {
                'blouse': 'üëî',
                'kurti': 'üëó',
                'salwar': 'ü•ª',
                'lehenga': 'üíÉ',
                'gown': 'üë∞',
                'other': 'üëò'
            };
            return icons[category] || 'üëò';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
